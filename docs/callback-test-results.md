# FreedomPay Callback - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## ‚úÖ –°—Ç–∞—Ç—É—Å: Callback —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

–Ø –ø—Ä–æ–≤–µ–ª –ø–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ callback'–∞ –æ—Ç FreedomPay –∏ –º–æ–≥—É –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å, —á—Ç–æ –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ.

## üîç –ß—Ç–æ –±—ã–ª–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ

### 1. –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å—Ç–∞—Ç—É—Å–æ–≤ –ø–ª–∞—Ç–µ–∂–∞
- ‚úÖ **–£—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç–µ–∂** (`pg_result = "1"`) ‚Üí —Å—Ç–∞—Ç—É—Å `paid`, –±–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω—è–µ—Ç—Å—è
- ‚úÖ **–£—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç–µ–∂** (`pg_result = 1`) ‚Üí —Å—Ç–∞—Ç—É—Å `paid`, –±–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω—è–µ—Ç—Å—è  
- ‚úÖ **–£—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç–µ–∂** (`pg_result = "ok"`) ‚Üí —Å—Ç–∞—Ç—É—Å `paid`, –±–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω—è–µ—Ç—Å—è
- ‚úÖ **–ù–µ—É—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç–µ–∂** (`pg_result = "0"`) ‚Üí —Å—Ç–∞—Ç—É—Å `failed`, –±–∞–ª–∞–Ω—Å –ù–ï –∏–∑–º–µ–Ω—è–µ—Ç—Å—è

### 2. –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ **–ü–æ–≤—Ç–æ—Ä–Ω—ã–π callback** ‚Üí –±–∞–ª–∞–Ω—Å –ù–ï –∏–∑–º–µ–Ω—è–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** ‚Üí —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–µ–π
- ‚úÖ **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏** ‚Üí –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏** ‚Üí –æ—Ç–∫–ª–æ–Ω—è–µ—Ç –Ω–µ–≤–µ—Ä–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∏
- ‚úÖ **–§–æ—Ä–º–∞—Ç –ø–æ–¥–ø–∏—Å–∏** ‚Üí —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º FreedomPay

### 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ **–ù–µ–≤–µ—Ä–Ω–∞—è –ø–æ–¥–ø–∏—Å—å** ‚Üí callback –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è
- ‚úÖ **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–π order_id** ‚Üí callback –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è
- ‚úÖ **–ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Å–µ—Å—Å–∏—è** ‚Üí callback –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. **`test_callback_logic.php`** - –¢–µ—Å—Ç –ª–æ–≥–∏–∫–∏ –±–µ–∑ Laravel
2. **`test_callback_http.sh`** - –¢–µ—Å—Ç HTTP endpoint'–∞
3. **`test_callback_endpoint.sh`** - –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç endpoint'–∞
4. **`docs/freedompay-callback-testing.md`** - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã

### –¢–µ—Å—Ç –ª–æ–≥–∏–∫–∏ (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç Laravel):
```bash
php test_callback_logic.php
```

### –¢–µ—Å—Ç HTTP endpoint (—Ç—Ä–µ–±—É–µ—Ç –∑–∞–ø—É—â–µ–Ω–Ω—ã–π Laravel):
```bash
./test_callback_http.sh
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```
=== –¢–µ—Å—Ç –ª–æ–≥–∏–∫–∏ FreedomPay Callback ===

üß™ –¢–µ—Å—Ç 1: –£—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç–µ–∂ ‚úÖ –ü–†–û–ô–î–ï–ù
üß™ –¢–µ—Å—Ç 2: –ù–µ—É—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç–µ–∂ ‚úÖ –ü–†–û–ô–î–ï–ù  
üß™ –¢–µ—Å—Ç 3: –ü–ª–∞—Ç–µ–∂ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º "ok" ‚úÖ –ü–†–û–ô–î–ï–ù
üß™ –¢–µ—Å—Ç 4: –ü–ª–∞—Ç–µ–∂ —Å —á–∏—Å–ª–æ–≤—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º 1 ‚úÖ –ü–†–û–ô–î–ï–ù
üîß –¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–∏ ‚úÖ –ü–†–û–ô–î–ï–ù
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ **MD5 –ø–æ–¥–ø–∏—Å–∏** –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è** —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
- ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ **–ê—Ç–æ–º–∞—Ä–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ `storage/logs/laravel.log`:

- `FreedomPay callback received` - –ø–æ–ª—É—á–µ–Ω callback
- `Payment completed and balance topped up successfully` - —É—Å–ø–µ—à–Ω–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
- `Payment completed but balance already topped up` - –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–æ
- `Payment failed` - –Ω–µ—É—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç–µ–∂
- `Invalid FreedomPay callback signature` - –Ω–µ–≤–µ—Ä–Ω–∞—è –ø–æ–¥–ø–∏—Å—å
- `Payment session not found` - —Å–µ—Å—Å–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**Callback –æ—Ç FreedomPay —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ.**

–°–∏—Å—Ç–µ–º–∞:
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —Å—Ç–∞—Ç—É—Å—ã –ø–ª–∞—Ç–µ–∂–µ–π
- ‚úÖ –ó–∞—â–∏—â–µ–Ω–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å–∏
- ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∞—É–¥–∏—Ç–∞
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ gracefully

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: Callback –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É.
