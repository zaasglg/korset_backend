# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤–∏–¥–µ–æ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –∑–∞–≥—Ä—É–∂–∞–µ–º—ã–µ –≤–∏–¥–µ–æ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

## –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### 1. üé¨ –°–∂–∞—Ç–∏–µ –≤–∏–¥–µ–æ
- **–ö–æ–¥–µ–∫**: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ H.264 (MP4)
- **–ö–∞—á–µ—Å—Ç–≤–æ**: CRF 28 (–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –∫–∞—á–µ—Å—Ç–≤–∞/—Ä–∞–∑–º–µ—Ä–∞)
- **–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ**: –ú–∞–∫—Å–∏–º—É–º 1280x720 (720p)
- **–ê—É–¥–∏–æ**: AAC 128kbps

### 2. üì± –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ —Å–∂–∞—Ç–∏–µ
- **1080p+**: –°–∂–∏–º–∞–µ—Ç—Å—è –¥–æ 720p —Å CRF 30
- **720p**: –£–º–µ—Ä–µ–Ω–Ω–æ–µ —Å–∂–∞—Ç–∏–µ —Å CRF 28
- **<720p**: –õ–µ–≥–∫–æ–µ —Å–∂–∞—Ç–∏–µ —Å CRF 26

### 3. üñºÔ∏è –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–≤—å—é
- **–†–∞–∑–º–µ—Ä**: 320x240 –ø–∏–∫—Å–µ–ª–µ–π
- **–í—Ä–µ–º—è**: 3 —Å–µ–∫—É–Ω–¥—ã –∏–ª–∏ 10% –æ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **–§–æ—Ä–º–∞—Ç**: JPEG

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

```env
# –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∏–¥–µ–æ
VIDEO_MAX_FILE_SIZE=104857600          # 100MB –º–∞–∫—Å–∏–º—É–º
VIDEO_OPTIMIZATION_ENABLED=true        # –í–∫–ª—é—á–∏—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é
VIDEO_GENERATE_THUMBNAILS=true         # –°–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–µ–≤—å—é

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
VIDEO_MAX_WIDTH=1280                   # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞
VIDEO_MAX_HEIGHT=720                   # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞
VIDEO_QUALITY=28                       # –ö–∞—á–µ—Å—Ç–≤–æ (CRF)
VIDEO_PRESET=medium                    # –°–∫–æ—Ä–æ—Å—Ç—å —Å–∂–∞—Ç–∏—è
VIDEO_AUDIO_BITRATE=128k              # –ë–∏—Ç—Ä–µ–π—Ç –∞—É–¥–∏–æ

# FFmpeg –ø—É—Ç–∏
FFMPEG_ENABLED=true
FFMPEG_PATH=/opt/homebrew/bin/ffmpeg
FFPROBE_PATH=/opt/homebrew/bin/ffprobe
```

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ FFmpeg

### macOS (Homebrew)
```bash
brew install ffmpeg
```

### Ubuntu/Debian
```bash
sudo apt update
sudo apt install ffmpeg
```

### CentOS/RHEL
```bash
sudo yum install epel-release
sudo yum install ffmpeg
```

## API –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –û—Ç–≤–µ—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –≤–∏–¥–µ–æ

**–ë—ã–ª–æ:**
```json
{
    "path": "videos/video.mov",
    "size": 50000000,
    "mime_type": "video/quicktime"
}
```

**–°—Ç–∞–ª–æ:**
```json
{
    "path": "videos/video_optimized.mp4",
    "url": "https://yourapi.com/storage/videos/video_optimized.mp4",
    "thumbnail": "https://yourapi.com/storage/thumbnails/video.jpg",
    "original_name": "video.mov",
    "original_size": 50000000,
    "optimized_size": 15000000,
    "compression_ratio": 70.0,
    "mime_type": "video/mp4",
    "duration": 120
}
```

## –ö–æ–º–∞–Ω–¥—ã Artisan

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –≤–∏–¥–µ–æ

```bash
# –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –Ω–µ–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ
php artisan videos:optimize

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –≤–∏–¥–µ–æ
php artisan videos:optimize --force
```

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**
```
Starting video optimization...
Found 25 videos to process.
 25/25 [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà] 100%

Optimized: iPhone –≤–∏–¥–µ–æ.mov
Size: 45.2 MB ‚Üí 12.8 MB
Saved: 32.4 MB (71.7%)

Video optimization completed!
Optimized: 23 videos
Skipped: 2 videos
Errors: 0 videos
Total space saved: 456.7 MB
Average compression: 68.3%
```

## –≠–∫–æ–Ω–æ–º–∏—è –º–µ—Å—Ç–∞

### –¢–∏–ø–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∂–∞—Ç–∏—è:

| –ò—Å—Ö–æ–¥–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç | –†–∞–∑–º–µ—Ä –¥–æ | –†–∞–∑–º–µ—Ä –ø–æ—Å–ª–µ | –≠–∫–æ–Ω–æ–º–∏—è |
|----------------|-----------|--------------|----------|
| iPhone MOV     | 45 MB     | 13 MB        | 71%      |
| Android MP4    | 32 MB     | 11 MB        | 66%      |
| –ö–∞–º–µ—Ä–∞ AVI     | 78 MB     | 18 MB        | 77%      |
| Drone 4K       | 120 MB    | 25 MB        | 79%      |

### –°—Ä–µ–¥–Ω–µ–µ —Å–∂–∞—Ç–∏–µ: **70-75%**

## –ö–∞—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ CRF (Constant Rate Factor):
- **18-23**: –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ (–±–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä)
- **24-28**: –•–æ—Ä–æ—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) ‚úÖ
- **29-35**: –°—Ä–µ–¥–Ω–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ (–º–∞–ª–µ–Ω—å–∫–∏–π —Ä–∞–∑–º–µ—Ä)
- **36+**: –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ

### –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- **CRF 28**: –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
- **Preset medium**: –•–æ—Ä–æ—à–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å —Å–∂–∞—Ç–∏—è
- **720p max**: –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

```php
// –í –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ
$product = Product::find(1);
$isOptimized = str_contains($product->video, '_optimized');
$hasThumb = !empty($product->thumbnail);
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∂–∞—Ç–∏—è

```php
// –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –≤—Å–µ–º –≤–∏–¥–µ–æ
$stats = Product::whereNotNull('video')
    ->selectRaw('
        COUNT(*) as total_videos,
        SUM(CASE WHEN video LIKE "%_optimized%" THEN 1 ELSE 0 END) as optimized_count,
        AVG(CASE WHEN video LIKE "%_optimized%" THEN compression_ratio ELSE NULL END) as avg_compression
    ')
    ->first();
```

## Troubleshooting

### FFmpeg –Ω–µ –Ω–∞–π–¥–µ–Ω
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É
which ffmpeg
ffmpeg -version

# –û–±–Ω–æ–≤–∏—Ç—å –ø—É—Ç—å –≤ .env
FFMPEG_PATH=/usr/local/bin/ffmpeg
```

### –û—à–∏–±–∫–∏ —Å–∂–∞—Ç–∏—è
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
tail -f storage/logs/laravel.log

# –¢–µ—Å—Ç–æ–≤–æ–µ —Å–∂–∞—Ç–∏–µ
ffmpeg -i input.mov -c:v libx264 -crf 28 output.mp4
```

### –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞
```bash
# –û—á–∏—Å—Ç–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
php artisan cache:clear
rm -rf storage/app/public/temp/*

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ
df -h
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:
1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ cron** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
   ```bash
   0 2 * * * cd /path/to/project && php artisan videos:optimize
   ```

2. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ**:
   ```bash
   # –î–æ–±–∞–≤–∏—Ç—å –≤ cron
   0 6 * * * df -h | mail -s "Disk Usage" admin@yoursite.com
   ```

3. **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ** –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
1. –û—Ç–∫–ª—é—á–∏—Ç–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é: `VIDEO_OPTIMIZATION_ENABLED=false`
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω—å—à–∏–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã
3. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –í—Ä–µ–º—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- **10 MB –≤–∏–¥–µ–æ**: ~30 —Å–µ–∫—É–Ω–¥
- **50 MB –≤–∏–¥–µ–æ**: ~2 –º–∏–Ω—É—Ç—ã  
- **100 MB –≤–∏–¥–µ–æ**: ~4 –º–∏–Ω—É—Ç—ã

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–æ—á–µ—Ä–µ–¥–∏** –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –≤ **—Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ**
- –ü–æ–∫–∞–∑—ã–≤–∞–π—Ç–µ **–ø—Ä–æ–≥—Ä–µ—Å—Å** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤–∏–¥–µ–æ –ø–æ–º–æ–∂–µ—Ç —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –¥–æ **75% –º–µ—Å—Ç–∞** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–∏–µ–º–ª–µ–º–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π!